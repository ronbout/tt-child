<?php
/**
 * Customer completed order email
 *
 * This template can be overridden by copying it to yourtheme/woocommerce/emails/customer-completed-order.php.
 *
 * HOWEVER, on occasion WooCommerce will need to update template files and you
 * (the theme developer) will need to copy the new files to your theme to
 * maintain compatibility. We try to do this as little as possible, but it does
 * happen. When this occurs the version of the template file will be bumped and
 * the readme will list any important changes.
 *
 * @see https://docs.woocommerce.com/document/template-structure/
 * @package WooCommerce\Templates\Emails
 * @version 3.7.0
 */

if ( ! defined( 'ABSPATH' ) ) {
	exit;
}

/*
 * @hooked WC_Emails::email_header() Output the email header
 */
do_action( 'woocommerce_email_header', $email_heading, $email ); ?>

<?php /* translators: %s: Customer first name */ ?>
<p><?php printf( esc_html__( 'Hi %s,', 'woocommerce' ), esc_html( $order->get_billing_first_name() ) ); ?></p>
<p><?php esc_html_e( 'We have finished processing your order.', 'woocommerce' ); ?></p>
<?php

/*
 * @hooked WC_Emails::order_details() Shows the order details table.
 * @hooked WC_Structured_Data::generate_order_data() Generates structured data.
 * @hooked WC_Structured_Data::output_structured_data() Outputs structured data.
 * @since 2.5.0
 */
$GLOBALS['completed_email_flag'] = true;
do_action( 'woocommerce_email_order_details', $order, $sent_to_admin, $plain_text, $email );

/*
 * @hooked WC_Emails::order_meta() Shows order meta data.
 */
do_action( 'woocommerce_email_order_meta', $order, $sent_to_admin, $plain_text, $email );


/**
 * check if any order item is bookable.  If it is, 
 * include the needed css for the display, including svg
 * 
 */
$booking_flg = false;
$items = $order->get_items();
foreach ( $items as $item_id => $item ) {
	$product       = $item->get_product();
	if ($product->get_meta('booking')) {
		$booking_flg = true;
		break;
	}
}
 
if ($booking_flg) {
	?>
	<style>
		.ot-powered-by {
			height: 24px;
			background-image:  url("data:image/svg+xml,%3Csvg width='107' height='24' viewBox='0 0 107 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cg clip-path='url(%23clip0_5278_24869)'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M0 11.9995C0 10.3605 1.32825 9.03125 2.9665 9.03125C4.60475 9.03125 5.9335 10.3605 5.9335 11.9995C5.9335 13.6395 4.60475 14.9688 2.9665 14.9688C1.32825 14.9688 0 13.6395 0 11.9995ZM20.8385 14.9688C19.2002 14.9688 17.8722 13.6395 17.8722 11.9998C17.8722 10.3605 19.2002 9.03125 20.8385 9.03125C22.477 9.03125 23.8057 10.3605 23.8057 11.9998C23.8057 13.6395 22.477 14.9688 20.8385 14.9688ZM20.839 0.125C14.285 0.125 8.972 5.44175 8.972 11.9998C8.972 18.5585 14.285 23.875 20.839 23.875C27.3932 23.875 32.706 18.5585 32.706 11.9998C32.706 5.44175 27.3932 0.125 20.839 0.125Z' fill='%23DA3743'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M105.654 11.0814C105.841 11.0814 105.952 10.9974 105.952 10.8446C105.952 10.7064 105.876 10.6156 105.667 10.6156H105.473V11.0814H105.654ZM105.188 10.3799H105.716C106.007 10.3799 106.257 10.4976 106.257 10.8311C106.257 10.9974 106.153 11.1579 106.001 11.2129L106.32 11.7899H106.001L105.757 11.3036H105.473V11.7899H105.188V10.3799ZM106.722 11.1019C106.722 10.4494 106.271 9.98364 105.689 9.98364C105.105 9.98364 104.661 10.4494 104.661 11.1019C104.661 11.7619 105.105 12.2131 105.689 12.2131C106.271 12.2131 106.722 11.7619 106.722 11.1019ZM104.383 11.1019C104.383 10.2891 104.973 9.73339 105.689 9.73339C106.41 9.73339 107 10.2891 107 11.1019C107 11.9146 106.41 12.4704 105.689 12.4704C104.973 12.4704 104.383 11.9146 104.383 11.1019ZM95.6743 16.6569C95.8501 16.6569 95.9986 16.5101 95.9986 16.3344V15.1424C95.9986 14.9664 95.8521 14.8199 95.6763 14.8199H95.6243C95.4788 14.8199 95.3333 14.6751 95.3333 14.5294L95.3336 14.4769V7.46639C95.3336 7.30514 95.1723 7.14389 95.0113 7.14389H93.8248C93.6638 7.14389 93.5028 7.30514 93.5028 7.46639V15.2904L93.5076 15.4941C93.5076 16.0766 94.0896 16.6586 94.6713 16.6586L95.6743 16.6569ZM43.4656 9.00989C45.0791 9.00989 46.4413 10.3776 46.4413 11.9996C46.4413 13.6361 45.1058 14.9651 43.4656 14.9651C41.8326 14.9651 40.5046 13.6361 40.5046 11.9996C40.5046 10.3509 41.8326 9.00989 43.4656 9.00989ZM43.4656 7.12607C40.7951 7.12607 38.6226 9.31232 38.6226 11.9993C38.6226 14.7181 40.7486 16.8481 43.4656 16.8481C46.1898 16.8481 48.3233 14.7181 48.3233 11.9993C48.3233 9.31232 46.1433 7.12607 43.4656 7.12607ZM82.1121 14.7256C82.0243 14.9749 81.4971 15.4439 80.8966 15.4439C80.2668 15.4439 79.9153 15.0626 79.9153 14.4911C79.9153 13.8904 80.3401 13.5239 81.1163 13.5239C81.6581 13.5239 82.1121 13.7291 82.1121 13.7291V14.7256ZM81.3213 9.72789C80.2228 9.72789 79.1536 10.0064 79.0071 10.0651C78.8608 10.1089 78.7288 10.2261 78.7876 10.4754L78.9341 11.2376C78.9633 11.4426 79.0951 11.6039 79.3148 11.5306C79.7103 11.4134 80.6036 11.2816 81.2188 11.2816C81.9363 11.2816 82.1853 11.6919 82.1561 12.5566C82.1561 12.5566 81.5411 12.3661 80.8526 12.3661C79.1391 12.3661 78.1578 13.2894 78.1578 14.4911C78.1578 15.9421 79.0951 16.8069 80.4426 16.8069C81.4971 16.8069 82.1708 16.3379 82.5663 15.9569V16.3206C82.5663 16.4966 82.7128 16.6431 82.8886 16.6431H83.0081C83.0203 16.6456 83.0348 16.6456 83.0496 16.6456H83.5476C83.7233 16.6456 83.8698 16.4991 83.8698 16.3231V12.6739C83.8698 10.8271 83.4303 9.72789 81.3213 9.72789ZM69.0258 9.72789C67.7296 9.72789 67.0998 10.4241 66.8483 10.7051V10.1969C66.8483 10.0211 66.7018 9.87439 66.5261 9.87439H65.7598C65.5986 9.87439 65.4376 10.0064 65.4376 10.1969V16.3231C65.4376 16.4991 65.5986 16.6456 65.7598 16.6456H66.8436C67.1658 16.6456 67.2683 16.5724 67.2683 16.3231V12.4539C67.4293 11.9849 67.8541 11.3986 68.7328 11.3986C69.5531 11.3986 69.9046 11.9411 69.9046 12.8204V16.3231C69.9046 16.4991 70.0511 16.6456 70.2268 16.6456H71.4131C71.5743 16.6456 71.7353 16.4991 71.7353 16.3231V12.8204C71.7353 11.1789 71.1788 9.72789 69.0258 9.72789ZM52.9003 15.1361C52.0508 15.1361 51.4943 14.7549 51.4943 14.7549V12.3366C51.6408 11.9556 52.1093 11.3986 52.9883 11.3986C54.0428 11.3986 54.5846 12.3221 54.5846 13.2746C54.5846 14.2274 54.0136 15.1361 52.9003 15.1361ZM53.2373 9.72789C51.8458 9.72789 51.0743 10.6781 51.0281 10.7366V10.1969C51.0281 10.0211 50.8816 9.87439 50.7058 9.87439H49.9858C49.8101 9.87439 49.6636 10.0211 49.6636 10.1969V19.0784C49.6636 19.2396 49.8101 19.4009 49.9858 19.4009H51.1721C51.3333 19.4009 51.4943 19.2396 51.4943 19.0784V16.5284C51.8018 16.6456 52.4463 16.8069 53.1201 16.8069C55.1413 16.8069 56.4741 15.2534 56.4741 13.2746C56.4741 11.2229 55.0826 9.72789 53.2373 9.72789ZM101.537 12.4094C101.508 11.7501 100.981 11.2374 100.234 11.2374C99.4136 11.2374 98.8863 11.7354 98.7986 12.4094H101.537ZM100.278 9.72764C102.035 9.72764 103.383 11.0321 103.383 12.8639C103.383 12.9664 103.368 13.2009 103.353 13.3036C103.339 13.4796 103.177 13.6114 103.031 13.6114H98.6958C98.7106 14.4466 99.3988 15.1794 100.38 15.1794C101.054 15.1794 101.523 14.9304 101.83 14.6814C101.991 14.5491 102.167 14.5346 102.27 14.6814L102.841 15.4431C102.958 15.5751 102.972 15.7364 102.811 15.8829C102.226 16.3811 101.391 16.8064 100.292 16.8064C98.2713 16.8064 96.8653 15.1941 96.8653 13.2596C96.8653 11.3544 98.2713 9.72764 100.278 9.72764ZM88.8153 15.1361C87.9366 15.1361 87.4678 14.5791 87.3213 14.1981V11.7799C87.3213 11.7799 87.8778 11.3986 88.7273 11.3986C89.8406 11.3986 90.4118 12.3074 90.4118 13.2601C90.4118 14.2126 89.8698 15.1361 88.8153 15.1361ZM88.9763 9.72789C88.3026 9.72789 87.6291 9.88914 87.3213 10.0211V7.44164C87.3213 7.28039 87.1748 7.11914 86.9991 7.11914H85.8128C85.6516 7.11914 85.4906 7.28039 85.4906 7.44164V16.3231C85.4906 16.4991 85.6516 16.6456 85.8128 16.6456H86.3253C86.3351 16.6456 86.3451 16.6456 86.3548 16.6431H86.4916C86.6696 16.6431 86.8161 16.4966 86.8161 16.3206V15.8199L86.8233 15.7956C86.8233 15.7956 87.5996 16.8069 89.0788 16.8069C90.9243 16.8069 92.2571 15.1946 92.2571 13.2601C92.2571 11.2816 90.9828 9.72789 88.9763 9.72789ZM78.6141 7.11914H71.7253C71.5643 7.11914 71.4471 7.25114 71.4471 7.39764V8.59939C71.4471 8.74589 71.5643 8.87789 71.7253 8.87789H74.2103V16.3671C74.2103 16.5136 74.3421 16.6456 74.4886 16.6456H75.8508C75.9971 16.6456 76.1291 16.5136 76.1291 16.3671V8.87789H78.6141C78.7751 8.87789 78.8923 8.74589 78.8923 8.59939V7.39764C78.8923 7.25114 78.7751 7.11914 78.6141 7.11914ZM62.2151 12.4094C62.1856 11.7501 61.6586 11.2374 60.9116 11.2374C60.0916 11.2374 59.5641 11.7354 59.4766 12.4094H62.2151ZM60.9556 9.72764C62.7131 9.72764 64.0603 11.0321 64.0603 12.8639C64.0603 12.9664 64.0458 13.2009 64.0313 13.3036C64.0163 13.4796 63.8553 13.6114 63.7088 13.6114H59.3738C59.3886 14.4466 60.0768 15.1794 61.0581 15.1794C61.7318 15.1794 62.2006 14.9304 62.5081 14.6814C62.6691 14.5491 62.8448 14.5346 62.9473 14.6814L63.5186 15.4431C63.6358 15.5751 63.6503 15.7364 63.4891 15.8829C62.9033 16.3811 62.0686 16.8064 60.9701 16.8064C58.9491 16.8064 57.5431 15.1941 57.5431 13.2596C57.5431 11.3544 58.9491 9.72764 60.9556 9.72764Z' fill='%232D333F'/%3E%3C/g%3E%3Cdefs%3E%3CclipPath id='clip0_5278_24869'%3E%3Crect width='107' height='24' fill='white'/%3E%3C/clipPath%3E%3C/defs%3E%3C/svg%3E");

			background-position: center;
			background-repeat: no-repeat;
			background-size: 107px 24px;
			margin-top: 12px; 
		}

		a.booking-link {
			text-decoration: none;
		}

		.ot-button {
			color: #ffffff;
			background-color: rgb(218, 55, 67);
			border: 1px solid rgb(218, 55, 67);
			cursor: pointer;
			display: block;
			font-weight: bold;
			padding: 14px 0 15px;
			text-align: center;
			text-decoration: none;
			width: 100%; 
			border-radius: 0 0 2px 2px;
		}
		.ot-button:focus, .ot-button:hover {
			background-color:  rgb(225, 91, 100);
			border: 1px solid rgb(225, 91, 100);
			color:  #ffffff;
		}
	</style>
	<?php

}


/*
 * @hooked WC_Emails::customer_details() Shows customer details
 * @hooked WC_Emails::email_address() Shows email address
 */
do_action( 'woocommerce_email_customer_details', $order, $sent_to_admin, $plain_text, $email );

/**
 * Show user-defined additional content - this is set in each email's settings.
 */
if ( $additional_content ) {
	echo wp_kses_post( wpautop( wptexturize( $additional_content ) ) );
}

/*
 * @hooked WC_Emails::email_footer() Output the email footer
 */
do_action( 'woocommerce_email_footer', $email );
